<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <link rel="shortcut icon" href="icon/Realm_transparent2.png" type="image/x-icon">
    <title>LOGIN</title>
</head>
<body>
    <div>
        <p id="username">Username</p>
        <p>send me anonymous messages!</p>
        <form id="messageForm" method="GET" action="https://spyderfalcon.42web.io/new/updatemessage">
            <textarea name="msg" id="msg"></textarea>
            <input type="hidden" name="username" id="usernameField">
            <input type="hidden" name="user" id="userField">
            <input type="hidden" name="url" id="urlField">
            <button type="submit">SEND</button>
        </form>
    </div>
    <script>
const queryString = window.location.search;
const urlParams = new URLSearchParams(queryString);
const user = urlParams.get('user');
const theme = urlParams.get('theme');
const username = document.getElementById("username");

// Retrieve the existing saved user and query string from localStorage
const savedUser = localStorage.getItem('user');
const savedQuery = localStorage.getItem('queryString');

// Save the current query string in localStorage if not already saved
if (!savedQuery) {
    localStorage.setItem('queryString', queryString);
}

// Use saved query string if current parameters are missing
const finalQuery = queryString || savedQuery || '';
const finalParams = new URLSearchParams(finalQuery);
const finalUser = finalParams.get('user') || user;
const finalTheme = finalParams.get('theme') || theme;

// Set document title and username element if user exists in localStorage or finalUser
if (savedUser) {
    document.title = savedUser;
    username.innerText = savedUser;
} else if (finalUser) {
    document.title = finalUser;
    username.innerText = finalUser;
}

// Set hidden input values before form submission
const form = document.getElementById("messageForm");
const usernameField = document.getElementById("usernameField");
const userField = document.getElementById("userField");
const urlField = document.getElementById("urlField");

if (finalUser) {
    usernameField.value = finalUser;
    userField.value = finalUser;
}

// Set the URL field to the saved or current query string
urlField.value = finalQuery;

form.addEventListener("submit", function(event) {
    const msg = document.getElementById("msg").value;
    if (msg.trim() === "") {
        event.preventDefault();
        alert("Message cannot be empty");
    }
});
    </script>
</body>
</html>
